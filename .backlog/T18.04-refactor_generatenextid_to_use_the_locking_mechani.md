---
id: "18.04"
title: Refactor GenerateNextID to use the locking mechanism
status: done
assignee: '@me'
labels:
    - refactoring
    - core
    - id-generation
dependencies: T18.03
parent: "18"
priority: high
created_at: 2025-09-21T21:59:31.045381Z
updated_at: 2025-09-21T22:40:11.734509Z
history:
    - timestamp: 2025-09-21T21:59:33.952332Z
      change: Description changed
    - timestamp: 2025-09-21T21:59:36.626692Z
      change: 'Added acceptance criterion #1: "CreateTask function in internal/core/create.go is updated to use the lock."'
    - timestamp: 2025-09-21T21:59:39.232985Z
      change: 'Added acceptance criterion #2: "The logic for finding the next ID is now inside the locked section."'
    - timestamp: 2025-09-21T21:59:42.151017Z
      change: 'Added acceptance criterion #3: "Existing tests for task creation pass with the new locking mechanism."'
    - timestamp: 2025-09-21T22:22:28.138473Z
      change: Status changed from "todo" to "in-progress"
      type: field_update
    - timestamp: 2025-09-21T22:22:30.411856Z
      change: Implementation plan changed
      type: field_update
    - timestamp: 2025-09-21T22:40:11.734505Z
      change: Status changed from "in-progress" to "done"
      type: field_update
    - timestamp: 2025-09-21T22:40:11.734505Z
      change: Implementation notes changed
      type: field_update
    - timestamp: 2025-09-21T22:40:11.734507Z
      change: 'Checked acceptance criterion #1: "CreateTask function in internal/core/create.go is updated to use the lock."'
      type: field_update
    - timestamp: 2025-09-21T22:40:11.734508Z
      change: 'Checked acceptance criterion #2: "The logic for finding the next ID is now inside the locked section."'
      type: field_update
    - timestamp: 2025-09-21T22:40:11.734508Z
      change: 'Checked acceptance criterion #3: "Existing tests for task creation pass with the new locking mechanism."'
      type: field_update
---
## Description

Modify the GenerateNextID function and its callers to use the newly implemented locking mechanism. This ensures that the process of determining the next available ID is serialized.

## Acceptance Criteria
<!-- AC:BEGIN -->

- [x] #1 CreateTask function in internal/core/create.go is updated to use the lock.
- [x] #2 The logic for finding the next ID is now inside the locked section.
- [x] #3 Existing tests for task creation pass with the new locking mechanism.

<!-- AC:END -->

## Implementation Plan

1. Modify FileTaskStore.Create to acquire lock before getNextTaskID and defer release. 2. Ensure getNextTaskID is called within locked section. 3. Verify existing tests pass.

## Implementation Notes

Refactored FileTaskStore.Create to use the Locker interface, ensuring atomic ID generation and task creation. All tests pass.
