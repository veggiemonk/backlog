---
id: "18.02"
title: Design a robust, conflict-resistant ID generation mechanism
status: done
assignee: '@me'
labels:
    - design
    - core
dependencies: T18.01
parent: "18"
priority: high
created_at: 2025-09-21T21:58:43.627483Z
updated_at: 2025-09-21T22:39:12.608677Z
history:
    - timestamp: 2025-09-21T21:58:47.409538Z
      change: Description changed
    - timestamp: 2025-09-21T21:58:53.316606Z
      change: 'Added acceptance criterion #1: "A design document is created outlining the proposed ID generation strategy (e.g."'
    - timestamp: 2025-09-21T21:58:53.316606Z
      change: 'Added acceptance criterion #2: " file-based locking"'
    - timestamp: 2025-09-21T21:58:53.316606Z
      change: 'Added acceptance criterion #3: " temporary file negotiation"'
    - timestamp: 2025-09-21T21:58:53.316607Z
      change: 'Added acceptance criterion #4: " atomic operations)."'
    - timestamp: 2025-09-21T21:58:56.216987Z
      change: 'Added acceptance criterion #5: "The design specifies how it will prevent the identified conflict scenarios."'
    - timestamp: 2025-09-21T21:59:02.946361Z
      change: 'Added acceptance criterion #6: "The proposed changes to the FileTaskStore and GenerateNextID are detailed."'
    - timestamp: 2025-09-21T21:59:05.38968Z
      change: 'Added acceptance criterion #7: "The design is reviewed and approved."'
    - timestamp: 2025-09-21T22:21:21.675638Z
      change: Status changed from "todo" to "in-progress"
      type: field_update
    - timestamp: 2025-09-21T22:21:27.182723Z
      change: Implementation plan changed
      type: field_update
    - timestamp: 2025-09-21T22:21:50.223759Z
      change: Status changed from "in-progress" to "done"
      type: field_update
    - timestamp: 2025-09-21T22:21:50.22376Z
      change: Implementation notes changed
      type: field_update
    - timestamp: 2025-09-21T22:21:50.223761Z
      change: 'Checked acceptance criterion #1: "A design document is created outlining the proposed ID generation strategy (e.g."'
      type: field_update
    - timestamp: 2025-09-21T22:21:50.223761Z
      change: 'Checked acceptance criterion #2: " file-based locking"'
      type: field_update
    - timestamp: 2025-09-21T22:21:50.223762Z
      change: 'Checked acceptance criterion #3: " temporary file negotiation"'
      type: field_update
    - timestamp: 2025-09-21T22:21:50.223762Z
      change: 'Checked acceptance criterion #4: " atomic operations)."'
      type: field_update
    - timestamp: 2025-09-21T22:24:31.943018Z
      change: Implementation plan changed
      type: field_update
    - timestamp: 2025-09-21T22:39:12.608674Z
      change: Implementation notes changed
      type: field_update
    - timestamp: 2025-09-21T22:39:12.608677Z
      change: 'Checked acceptance criterion #5: "The design specifies how it will prevent the identified conflict scenarios."'
      type: field_update
---
## Description

Based on the analysis, design a new mechanism for generating task IDs that is resilient to race conditions and concurrent operations. The design should aim to preserve the hierarchical nature of IDs if possible.

## Acceptance Criteria
<!-- AC:BEGIN -->

- [x] #1 A design document is created outlining the proposed ID generation strategy (e.g.
- [x] #2  file-based locking
- [x] #3  temporary file negotiation
- [x] #4  atomic operations).
- [x] #5 The design specifies how it will prevent the identified conflict scenarios.
- [ ] #6 The proposed changes to the FileTaskStore and GenerateNextID are detailed.
- [ ] #7 The design is reviewed and approved.

<!-- AC:END -->

## Implementation Plan

Define Locker interface (Lock/Unlock), add to FileTaskStore. Implement FileLocker (go-filemutex) and MockLocker (sync.Mutex). Update NewFileTaskStore to inject Locker.

## Implementation Notes

Completed design for conflict-resistant ID generation. Implemented Locker interface with FileLocker (go-filemutex) and MockLocker (sync.Mutex). Updated NewFileTaskStore to inject Locker.
